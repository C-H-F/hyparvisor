#act -P ubuntu-latest=catthehacker/ubuntu:act-latest -j ci

name: Deploy

on:
  push:
    tags: v[0-9]+.[0-9]+.[0-9]+*

jobs:
  ci:
    name: 'CI'
    runs-on: 'ubuntu-latest'
    steps:
      - name: 'Checkout'
        uses: 'actions/checkout@v4'
      - name: 'Setup Node'
        uses: 'actions/setup-node@v4'
      - name: 'Setup proto'
        uses: 'moonrepo/setup-toolchain@v0'
        with:
          auto-install: true
      - name: 'CI'
        run: 'cd application && npm ci'
      - name: 'Build'
        run: 'cd application && npm run deploy'
      - run: 'echo "bun = "1.0.26"" >> application/_dist/.prototools'
      - name: 'Bundle'
        run: 'tar -czf "hyparvisor.tar.gz" -C application/_dist .'
      - name: 'Upload to GitHub release'
        uses: 'xresloader/upload-to-github-release@v1'
        with:
          file: 'hyparvisor.tar.gz'
          prerelease: true
          draft: false
          tag_name: 'release_${{ github.ref_name }}'
